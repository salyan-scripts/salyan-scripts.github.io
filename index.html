<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√≠blia Comparativa</title>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;600&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #ffffff; --text: #1a1a1a; --border: #eeeeee; --accent: #3498db;
        }
        [data-theme="dark"] {
            --bg: #121212; --text: #e0e0e0; --border: #333333; --accent: #5dade2;
        }
        body { margin: 0; font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); }
        
        header { 
            position: sticky; top: 0; background: var(--bg); border-bottom: 1px solid var(--border);
            padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; z-index: 100;
        }

        .controls { display: flex; gap: 10px; }
        button { padding: 8px 15px; border-radius: 6px; border: 1px solid var(--border); background: var(--bg); color: var(--text); cursor: pointer; }
        button.active { background: var(--accent); color: white; border-color: var(--accent); }

        main { max-width: 900px; margin: 0 auto; padding: 20px; }
        
        /* Estilo da Compara√ß√£o Vertical */
        .verse-container { margin-bottom: 25px; padding-bottom: 15px; border-bottom: 1px solid var(--border); }
        .verse-text { font-family: 'Crimson Pro', serif; font-size: 1.25rem; line-height: 1.5; margin-bottom: 8px; }
        .v-label { font-size: 0.7rem; font-weight: bold; padding: 2px 6px; border-radius: 4px; background: var(--border); margin-right: 8px; }
        .v-num { font-weight: bold; color: var(--accent); margin-right: 10px; }
        
        .nvi-text { color: #7f8c8d; } /* Cor um pouco diferente para a NVI */
        [data-theme="dark"] .nvi-text { color: #95a5a6; }

        .overlay { position: fixed; inset: 0; background: var(--bg); display: none; z-index: 200; padding: 20px; overflow-y: auto; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px; margin-top: 20px; }
        .card { padding: 15px; border: 1px solid var(--border); border-radius: 8px; text-align: center; cursor: pointer; }
        
        #error-msg { color: red; text-align: center; padding: 20px; display: none; }
    </style>
</head>
<body>

<header>
    <h2 id="current-title" onclick="openNav()" style="cursor:pointer">Carregando...</h2>
    <div class="controls">
        <button id="btn-compare" onclick="toggleCompare()">Comparar NVI</button>
        <button onclick="toggleTheme()">üåì</button>
    </div>
</header>

<div id="error-msg">Ops! N√£o conseguimos carregar os arquivos da B√≠blia. Verifique se acf.json e nvi.json est√£o na pasta.</div>

<main id="bible-content"></main>

<div id="nav-books" class="overlay">
    <h3>Escolha o Livro</h3>
    <div id="book-grid" class="grid"></div>
</div>

<div id="nav-chaps" class="overlay">
    <button onclick="closeOverlay('nav-chaps')">Voltar</button>
    <h3>Cap√≠tulos</h3>
    <div id="chap-grid" class="grid"></div>
</div>

<script>
    let bibleACF = null;
    let bibleNVI = null;
    let currentB = 0;
    let currentC = 0;
    let compareMode = false;

    // Mapeamento simples de abrevia√ß√£o para Nome (J√° que seus JSONs n√£o tem o campo 'name')
    const bookNames = {"gn": "G√™nesis", "ex": "√äxodo", "lv": "Lev√≠tico", "nm": "N√∫meros", "dt": "Deuteron√¥mio", "js": "Josu√©", "jz": "Ju√≠zes", "rt": "Rute", "1sm": "1 Samuel", "2sm": "2 Samuel", "1rs": "1 Reis", "2rs": "2 Reis", "1cr": "1 Cr√¥nicas", "2cr": "2 Cr√¥nicas", "ed": "Esdras", "ne": "Neemias", "et": "Ester", "j√≥": "J√≥", "sl": "Salmos", "pv": "Prov√©rbios", "ec": "Eclesiastes", "ct": "Cantares", "is": "Isa√≠as", "jr": "Jeremias", "lm": "Lamenta√ß√µes", "ez": "Ezequiel", "dn": "Daniel", "os": "Os√©ias", "jl": "Joel", "am": "Am√≥s", "ob": "Obadias", "jn": "Jonas", "mq": "Miqu√©ias", "na": "Naum", "hc": "Habacuque", "sf": "Sofonias", "ag": "Ageu", "zc": "Zacarias", "ml": "Malaquias", "mt": "Mateus", "mc": "Marcos", "lc": "Lucas", "jo": "Jo√£o", "at": "Atos", "rm": "Romanos", "1co": "1 Cor√≠ntios", "2co": "2 Cor√≠ntios", "gl": "G√°latas", "ef": "Ef√©sios", "fp": "Filipenses", "cl": "Colossenses", "1ts": "1 Tessalonicenses", "2ts": "2 Tessalonicenses", "1tm": "1 Tim√≥teo", "2tm": "2 Tim√≥teo", "tt": "Tito", "fm": "Filemon", "hb": "Hebreus", "tg": "Tiago", "1pe": "1 Pedro", "2pe": "2 Pedro", "1jo": "1 Jo√£o", "2jo": "2 Jo√£o", "3jo": "3 Jo√£o", "jd": "Judas", "ap": "Apocalipse"};

    async function start() {
        try {
            const [res1, res2] = await Promise.all([
                fetch('acf.json'),
                fetch('nvi.json')
            ]);
            
            if (!res1.ok || !res2.ok) throw new Error("Erro ao baixar arquivos");

            bibleACF = await res1.json();
            bibleNVI = await res2.json();

            // Pega progresso salvo
            currentB = parseInt(localStorage.getItem('savedB')) || 0;
            currentC = parseInt(localStorage.getItem('savedC')) || 0;
            compareMode = localStorage.getItem('compare') === 'true';

            if(compareMode) document.getElementById('btn-compare').classList.add('active');

            renderBooks();
            displayChapter();
        } catch (err) {
            console.error(err);
            document.getElementById('error-msg').style.display = 'block';
        }
    }

    function displayChapter() {
        const container = document.getElementById('bible-content');
        const bookA = bibleACF[currentB];
        const bookN = bibleNVI[currentB];
        const chapA = bookA.chapters[currentC];
        const chapN = bookN.chapters[currentC];

        const fullName = bookNames[bookA.abbrev.toLowerCase()] || bookA.abbrev.toUpperCase();
        document.getElementById('current-title').innerText = `${fullName} ${currentC + 1}`;

        let html = '';
        chapA.forEach((verse, i) => {
            html += `
                <div class="verse-container">
                    <div class="verse-text">
                        <span class="v-num">${i+1}</span>
                        ${compareMode ? '<span class="v-label">ACF</span>' : ''}
                        ${verse}
                    </div>
                    ${compareMode ? `
                    <div class="verse-text nvi-text">
                        <span class="v-label">NVI</span>
                        ${chapN[i] || '[Vers√≠culo n√£o dispon√≠vel nesta vers√£o]'}
                    </div>` : ''}
                </div>
            `;
        });

        container.innerHTML = html;
        localStorage.setItem('savedB', currentB);
        localStorage.setItem('savedC', currentC);
        window.scrollTo(0,0);
    }

    function toggleCompare() {
        compareMode = !compareMode;
        localStorage.setItem('compare', compareMode);
        document.getElementById('btn-compare').classList.toggle('active');
        displayChapter();
    }

    function renderBooks() {
        const grid = document.getElementById('book-grid');
        grid.innerHTML = bibleACF.map((b, i) => {
            const name = bookNames[b.abbrev.toLowerCase()] || b.abbrev.toUpperCase();
            return `<div class="card" onclick="openChapters(${i})">${name}</div>`;
        }).join('');
    }

    function openChapters(i) {
        currentB = i;
        document.getElementById('nav-books').style.display = 'none';
        const grid = document.getElementById('chap-grid');
        grid.innerHTML = bibleACF[i].chapters.map((_, c) => `
            <div class="card" onclick="selectChap(${c})">${c+1}</div>
        `).join('');
        document.getElementById('nav-chaps').style.display = 'block';
    }

    function selectChap(c) {
        currentC = c;
        document.getElementById('nav-chaps').style.display = 'none';
        displayChapter();
    }

    function openNav() { document.getElementById('nav-books').style.display = 'block'; }
    function closeOverlay(id) { document.getElementById(id).style.display = 'none'; }
    function toggleTheme() {
        const b = document.body;
        b.setAttribute('data-theme', b.getAttribute('data-theme') === 'dark' ? 'light' : 'dark');
    }

    start();
</script>
</body>
</html>
