<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>B√≠blia Pro</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#007bff">
    <meta name="apple-mobile-web-app-capable" content="yes">

    <style>
        :root {
            --bg: #ffffff; --text: #1a1a1a; --panel: #f1f3f5; --border: #dee2e6; --accent: #007bff;
            --font-size: 18px; --font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }
        [data-theme="dark"] {
            --bg: #121212; --text: #e9ecef; --panel: #2b2f33; --border: #3d4246; --accent: #339af0;
        }

        .font-jornal { font-family: 'Crimson Pro', 'Georgia', 'Times New Roman', serif; }
        .font-moderna { font-family: 'Lato', 'Verdana', sans-serif; }
        .font-padrao { font-family: 'Inter', 'system-ui', sans-serif; }

        body { 
            margin: 0; background: var(--bg); color: var(--text); 
            font-family: var(--font-family); font-size: var(--font-size);
            transition: background 0.3s; padding-bottom: 90px;
            user-select: none;
        }

        header {
            position: sticky; top: 0; background: var(--bg); border-bottom: 1px solid var(--border);
            padding: 10px 15px; display: flex; gap: 10px; align-items: center; z-index: 1000;
        }
        .search-box {
            flex: 1; display: flex; background: var(--panel); border-radius: 20px; padding: 5px 15px; border: 1px solid var(--border);
        }
        .search-box input {
            border: none; background: none; color: var(--text); outline: none; width: 100%; font-size: 16px;
        }
        .icon-btn { background: none; border: none; font-size: 1.3rem; cursor: pointer; color: var(--text); }

        main { max-width: 800px; margin: 0 auto; padding: 20px; min-height: 70vh; }
        .verse-row { padding: 12px; border-radius: 8px; cursor: pointer; border-bottom: 1px solid var(--border); line-height: 1.5; }
        .verse-row:active { background: var(--panel); }
        .v-num { font-weight: bold; color: var(--accent); font-size: 0.8em; margin-right: 10px; vertical-align: super; }
        .nvi-text { display: block; margin-top: 6px; opacity: 0.7; font-size: 0.95em; border-left: 2px solid var(--accent); padding-left: 10px; }

        footer { max-width: 800px; margin: 30px auto; padding: 20px; border-top: 2px solid var(--border); }
        .book-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 8px; }
        .book-btn { background: var(--panel); border: 1px solid var(--border); padding: 10px; border-radius: 6px; text-align: center; cursor: pointer; font-size: 0.85rem; color: var(--text); }

        .nav-bar { position: fixed; bottom: 0; left: 0; width: 100%; background: var(--bg); border-top: 1px solid var(--border); padding: 10px; display: flex; justify-content: center; gap: 8px; z-index: 1000; }
        .nav-item { flex: 1; max-width: 70px; padding: 12px; border: 1px solid var(--border); background: var(--panel); border-radius: 8px; text-align: center; font-weight: bold; cursor: pointer; }

        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.6); display: none; justify-content: center; align-items: flex-end; z-index: 2000; }
        .modal-content { background: var(--bg); width: 100%; max-width: 500px; padding: 20px; border-radius: 20px 20px 0 0; box-shadow: 0 -5px 15px rgba(0,0,0,0.3); }
        .opt-row { margin-bottom: 18px; }
        .opt-title { font-size: 0.8rem; font-weight: bold; color: var(--accent); display: block; margin-bottom: 10px; text-transform: uppercase; }
        .btn-group { display: flex; gap: 6px; flex-wrap: wrap; }
        .btn-group button { flex: 1; padding: 12px; border: 1px solid var(--border); border-radius: 10px; background: var(--panel); color: var(--text); cursor: pointer; font-size: 0.9rem; }
        .btn-group button.active { background: var(--accent); color: white; border-color: var(--accent); }

        #toast { position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); background: #333; color: white; padding: 10px 25px; border-radius: 30px; opacity: 0; transition: 0.3s; pointer-events: none; z-index: 3000; }

        .highlight { background-color: #ffff99; }
    </style>
</head>
<body data-theme="light">

<header>
    <div onclick="window.scrollTo({top: document.body.scrollHeight, behavior: 'smooth'})" style="cursor:pointer; font-weight:bold; min-width: 100px;">
        üìñ <span id="cur-ref">G√™nesis 1</span>
    </div>
    <div class="search-box">
        <input type="text" id="inp-search" placeholder="Ex: Jo√£o 3.16 ou Jo√£o 3,16" autocomplete="off">
        <button class="icon-btn" onclick="doSearch()">üîç</button>
    </div>
    <button class="icon-btn" onclick="toggleModal(true)">‚öôÔ∏è</button>
</header>

<main id="bible-box">
    <div style="text-align:center; padding:50px; font-style: italic;">Carregando Palavra...</div>
</main>

<footer>
    <h3 style="text-align:center; margin-bottom: 20px;">√çndice de Livros</h3>
    <div class="book-grid" id="footer-books"></div>
    <div style="margin-top: 20px; text-align: center;">
        <select id="chapter-select" style="padding: 10px; font-size: 16px; border: 1px solid var(--border); border-radius: 5px; background: var(--panel); color: var(--text);">
            <option value="">Selecione Cap√≠tulo</option>
        </select>
    </div>
</footer>

<div class="nav-bar">
    <div class="nav-item" onclick="navigate('pb')" title="Livro Anterior">¬´</div>
    <div class="nav-item" onclick="navigate('pc')" title="Cap√≠tulo Anterior">‚Äπ</div>
    <div class="nav-item" onclick="navigate('nc')" title="Pr√≥ximo Cap√≠tulo">‚Ä∫</div>
    <div class="nav-item" onclick="navigate('nb')" title="Pr√≥ximo Livro">¬ª</div>
</div>

<div id="cfg-modal" class="modal" onclick="toggleModal(false)">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="opt-row">
            <span class="opt-title">Vers√£o da B√≠blia</span>
            <div class="btn-group">
                <button id="v-acf" onclick="setVer('acf')">ACF</button>
                <button id="v-nvi" onclick="setVer('nvi')">NVI</button>
                <button id="v-dual" onclick="setVer('dual')">Comparar</button>
            </div>
        </div>
        <div class="opt-row">
            <span class="opt-title">Estilo de Fonte</span>
            <div class="btn-group">
                <button id="f-Inter" class="font-padrao" onclick="setFnt('Inter')">Padr√£o</button>
                <button id="f-Crimson" class="font-jornal" onclick="setFnt('Crimson Pro')">Jornal</button>
                <button id="f-Lato" class="font-moderna" onclick="setFnt('Lato')">Moderna</button>
            </div>
        </div>
        <div class="opt-row">
            <span class="opt-title">Tamanho da Letra</span>
            <div class="btn-group">
                <button onclick="chSize(-2)">A -</button>
                <button onclick="chSize(0)">Normal</button>
                <button onclick="chSize(2)">A +</button>
            </div>
        </div>
        <div class="opt-row">
            <span class="opt-title">Visualiza√ß√£o</span>
            <div class="btn-group">
                <button id="t-light" onclick="setThm('light')">‚òÄÔ∏è Claro</button>
                <button id="t-dark" onclick="setThm('dark')">üåô Escuro</button>
            </div>
        </div>
        <button onclick="toggleModal(false)" style="width:100%; padding:15px; border:none; background:var(--accent); color:white; border-radius:12px; margin-top:10px; font-weight:bold; cursor:pointer;">CONCLU√çDO</button>
    </div>
</div>

<div id="toast">Copiado para a √°rea de transfer√™ncia!</div>

<script>
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('./sw.js')
                .then(reg => console.log('Offline Ready'))
                .catch(err => console.log('SW Error', err));
        });
    }

    let data = { acf: [], nvi: [] };
    let cfg = { b: 0, c: 0, v: 'acf', f: 'Inter', s: 18, t: 'light' };
    const bNames = ["G√™nesis","√äxodo","Lev√≠tico","N√∫meros","Deuteron√¥mio","Josu√©","Ju√≠zes","Rute","1 Samuel","2 Samuel","1 Reis","2 Reis","1 Cr√¥nicas","2 Cr√¥nicas","Esdras","Neemias","Ester","J√≥","Salmos","Prov√©rbios","Eclesiastes","Cantares","Isa√≠as","Jeremias","Lamenta√ß√µes","Ezequiel","Daniel","Os√©ias","Joel","Am√≥s","Obadias","Jonas","Miqu√©ias","Naum","Habacuque","Sofonias","Ageu","Zacarias","Malaquias","Mateus","Marcos","Lucas","Jo√£o","Atos","Romanos","1 Cor√≠ntios","2 Cor√≠ntios","G√°latas","Ef√©sios","Filipenses","Colossenses","1 Tessalonicenses","2 Tessalonicenses","1 Tim√≥teo","2 Tim√≥teo","Tito","Filemon","Hebreus","Tiago","1 Pedro","2 Pedro","1 Jo√£o","2 Jo√£o","3 Jo√£o","Judas","Apocalipse"];

    async function init() {
        try {
            const [r1, r2] = await Promise.all([
                fetch('acf.json').then(r => r.json()),
                fetch('nvi.json').then(r => r.json())
            ]);
            data.acf = r1;
            data.nvi = r2;
            
            const saved = JSON.parse(localStorage.getItem('biblia_v5_save'));
            if(saved) cfg = {...cfg, ...saved};
            
            document.getElementById('inp-search').addEventListener('keypress', (e) => { if(e.key === 'Enter') doSearch(); });

            renderBooks();
            applyCfg();
            draw();
            populateChapters();
        } catch(e) { 
            document.getElementById('bible-box').innerHTML = "B√≠blia dispon√≠vel offline. Carregando...";
            setTimeout(init, 1000);
        }
    }

    function draw(highlightVerse = null) {
        const box = document.getElementById('bible-box');
        if(!data.acf[cfg.b]) return;
        
        const b = data.acf[cfg.b];
        document.getElementById('cur-ref').innerText = `${bNames[cfg.b]} ${cfg.c + 1}`;
        
        let html = '';
        const chA = b.chapters[cfg.c];
        const chN = data.nvi[cfg.b].chapters[cfg.c];

        chA.forEach((v, i) => {
            const verseId = `verse-${i+1}`;
            html += `<div id="${verseId}" class="verse-row" onclick="copyVerse(this, '${bNames[cfg.b]} ${cfg.c+1}:${i+1}')">`;
            if(cfg.v === 'acf' || cfg.v === 'dual') {
                html += `<div><span class="v-num">${i+1}</span>${v}</div>`;
            }
            if(cfg.v === 'nvi' || cfg.v === 'dual') {
                const txt = chN[i] || '';
                html += `<div class="nvi-text">${cfg.v === 'dual' ? '<b>NVI:</b> ' : ''}${txt}</div>`;
            }
            html += `</div>`;
        });

        box.innerHTML = html;
        window.scrollTo(0,0);
        localStorage.setItem('biblia_v5_save', JSON.stringify(cfg));

        if (highlightVerse) {
            setTimeout(() => {
                const el = document.getElementById(`verse-${highlightVerse}`);
                if (el) {
                    el.classList.add('highlight');
                    el.scrollIntoView({ behavior: 'smooth' });
                    setTimeout(() => el.classList.remove('highlight'), 3000);
                }
            }, 100);
        }
    }

    function doSearch() {
        const inp = document.getElementById('inp-search');
        let q = inp.value.toLowerCase().trim();
        if(!q) return;

        q = q.replace(',', '.');

        const match = q.match(/(\d?\s?[a-z√ß√£√µ√™√≠√≥√∫]+)\s+(\d+)(?:\.(\d+))?/);
        if(match) {
            const name = match[1].trim();
            const chap = parseInt(match[2]) - 1;
            const verse = match[3] ? parseInt(match[3]) : null;
            const idx = bNames.findIndex(n => n.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").startsWith(name));

            if(idx !== -1 && chap >= 0 && chap < data.acf[idx].chapters.length) {
                cfg.b = idx; 
                cfg.c = chap; 
                populateChapters();
                document.getElementById('chapter-select').value = chap + 1;
                draw(verse);
                inp.blur();
            }
        }
    }

    function navigate(op) {
        if(op==='nc') { 
            if(cfg.c < data.acf[cfg.b].chapters.length-1) cfg.c++; 
            else if(cfg.b < 65) { cfg.b++; cfg.c=0; }
        } else if(op==='pc') {
            if(cfg.c > 0) cfg.c--;
            else if(cfg.b > 0) { cfg.b--; cfg.c = data.acf[cfg.b].chapters.length-1; }
        } else if(op==='nb') { if(cfg.b < 65) { cfg.b++; cfg.c=0; }
        } else if(op==='pb') { if(cfg.b > 0) { cfg.b--; cfg.c=0; } }
        populateChapters();
        document.getElementById('chapter-select').value = cfg.c + 1;
        draw();
    }

    function renderBooks() {
        document.getElementById('footer-books').innerHTML = bNames.map((n, i) => 
            `<div class="book-btn" onclick="selectBook(${i})">${n}</div>`
        ).join('');
    }

    function selectBook(i) {
        cfg.b = i; 
        cfg.c = 0; 
        populateChapters();
        document.getElementById('chapter-select').value = 1;
        draw();
        window.scrollTo({top:0, behavior:'smooth'});
    }

    function populateChapters() {
        const select = document.getElementById('chapter-select');
        select.innerHTML = '<option value="">Selecione Cap√≠tulo</option>';
        if (data.acf[cfg.b]) {
            const numChapters = data.acf[cfg.b].chapters.length;
            for (let ch = 1; ch <= numChapters; ch++) {
                const opt = document.createElement('option');
                opt.value = ch;
                opt.textContent = ch;
                select.appendChild(opt);
            }
        }
        select.addEventListener('change', (e) => {
            const val = e.target.value;
            if (val) {
                cfg.c = val - 1;
                draw();
            }
        });
    }

    function copyVerse(el, ref) {
        const t = el.innerText.replace(/NVI:/g, '').replace(/\s+/g, ' ').trim();
        navigator.clipboard.writeText(`${t} (${ref})`);
        const toast = document.getElementById('toast');
        toast.style.opacity = 1; setTimeout(() => toast.style.opacity = 0, 2000);
    }

    function toggleModal(s) { document.getElementById('cfg-modal').style.display = s ? 'flex' : 'none'; }
    function setVer(v) { cfg.v = v; draw(); applyCfg(); }
    function setThm(t) { cfg.t = t; applyCfg(); }
    function setFnt(f) { cfg.f = f; applyCfg(); }
    function chSize(d) { if(d===0) cfg.s=18; else cfg.s+=d; applyCfg(); }

    function applyCfg() {
        document.body.setAttribute('data-theme', cfg.t);
        document.documentElement.style.setProperty('--font-size', cfg.s + 'px');
        
        let fontValue = "'Inter', sans-serif";
        if(cfg.f === 'Crimson Pro') fontValue = "'Crimson Pro', 'Georgia', serif";
        if(cfg.f === 'Lato') fontValue = "'Lato', 'Verdana', sans-serif";
        
        document.documentElement.style.setProperty('--font-family', fontValue);
        
        document.querySelectorAll('.btn-group button').forEach(b => b.classList.remove('active'));
        const vBtn = document.getElementById('v-'+cfg.v); if(vBtn) vBtn.classList.add('active');
        const fBtn = document.getElementById('f-'+cfg.f.split(' ')[0]); if(fBtn) fBtn.classList.add('active');
        const tBtn = document.getElementById('t-'+cfg.t); if(tBtn) tBtn.classList.add('active');
        
        localStorage.setItem('biblia_v5_save', JSON.stringify(cfg));
    }

    init();
</script>
</body>
</html>
